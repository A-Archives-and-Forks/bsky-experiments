services:
  indexer:
    build:
      context: ../../../
      dockerfile: atproto/build/search/Dockerfile
      args:
        - GIT_COMMIT=${GIT_COMMIT:-unknown}
        - BUILD_TIME=${BUILD_TIME:-unknown}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    restart: unless-stopped
    image: search
    container_name: bsky-search
    environment:
      - GIN_MODE=release
    env_file:
      - ../../env/search.env
    ports:
      - "8092:8080"
      - "8093:8081"
